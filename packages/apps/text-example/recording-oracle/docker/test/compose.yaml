version: "3.8"

services:
  # EXCHANGE ORACLE
  test:
    build:
      context: ../../
      dockerfile: docker/test/Dockerfile
    network_mode: "host"
    extra_hosts:
      - "host.docker.internal:host-gateway"
    depends_on:
      minio:
        condition: service_started
      postgres_exchange_oracle:
        condition: service_started
    tty: true
  postgres_exchange_oracle:
    image: postgres:14.4
    restart: on-failure
    environment:
      POSTGRES_PASSWORD: '${PG_USER}'
      POSTGRES_USER: '${PG_PASSWORD}'
      POSTGRES_DB: '${PG_DB}'
      PGDATA: '/var/lib/postgresql/data/pgdata'
    volumes:
      - postgres:/var/lib/postgresql/data/pgdata
    ports:
      - ${PG_PORT}:${PG_PORT}
    command: ["postgres", "-c", "log_statement=all", "-p", "${PG_PORT}"]
  minio:
    image: quay.io/minio/minio
    network_mode: "host"
    container_name: minio_server
    restart: on-failure
    volumes:
      - ~/minio:/data
    environment:
      - MINIO_ROOT_USER=${MINIO_ROOT_USER}
      - MINIO_ROOT_PASSWORD=${MINIO_ROOT_PASSWORD}
    extra_hosts:
      - "host.docker.internal:host-gateway"
    command: minio server --console-address ":9090" /data


volumes:
  postgres:
  minio_data:
    driver: local